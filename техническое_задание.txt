# ТЗ на разработку MVP системы мониторинга "KASTOR IoT"

## 1. Цель проекта
Создать интерактивный прототип (MVP) системы мониторинга газопоршневых установок (ГПУ).
**Ключевая задача:** Показать заказчику, как система выявляет финансовые потери в реальном времени, прогнозирует аварии и упрощает контроль ТО. Интерфейс должен вызывать «Вау-эффект» за счет анимаций, живости данных и фокуса на деньгах.

## 2. Технологический стек
*   **Frontend:** SvelteKit, TailwindCSS, Shadcn-UI (компоненты), Lucide (иконки).
*   **Charts:** Apache ECharts (сложные графики), svelte-motion (анимации цифр).
*   **Backend Runtime:** Bun.
*   **Database:** TimescaleDB (хранение телеметрии) + Drizzle ORM.
*   **Transport:** MQTT Broker (EMQX) — прием данных.
*   **Deployment:** Docker Compose (все сервисы в одной коробке).

***

## 3. Архитектура Данных (Мок-сценарий)
Скрипт эмуляции (`mock-device.ts`) должен разыгрывать сценарий **«Проблема с качеством газа»**:
1.  **Объекты:** 6 машин (ГПУ-1 ... ГПУ-6).
2.  **Параметры:**
    *   `Active Power` (кВт) — Активная мощность.
    *   `Exhaust Temp` (°C) — Температура выхлопа (средняя).
    *   `Cylinder Temps` (Array[]) — Температуры по 20 цилиндрам (для тепловой карты).
    *   `Vibration` (мм/с) — Вибрация.
    *   `Gas Pressure` (кПа) — Давление газа.
    *   `Efficiency` (%) — Мгновенный КПД.
3.  **Сценарий Аварии (ГПУ-2):**
    *   `00:00 - 00:30`: Работает нормально (1200 кВт, 480°C).
    *   `00:30`: **Растет вибрация** (с 5 до 12 мм/с). *Система должна выдать Warning.*
    *   `00:45`: **Резкий рост температуры** (до 540°C) из-за детонации.
    *   `00:50`: **Падение мощности** (автоматика снижает до 900 кВт).
    *   `Результат`: КПД падает до 35%, убыток растет до 2000 руб/час.

***

## 4. Интерфейс и Экраны (UI/UX)

### Экран 1: Главный Дашборд («Пульс Бизнеса»)
**Задача:** Мгновенно показать статус денег и флота.

1.  **Верхняя панель (KPIs):**
    *   **Total Power:** Сумма кВт всех машин.
    *   **Fleet Health:** Круговой индикатор (среднее здоровье).
    *   **Current Loss (LIVE):** Огромная цифра с анимацией-тикером. Если убыток > 0, она красная и пульсирует. *Подпись: "Потеря за смену: 14 500 ₽".*
2.  **Карта Флота (Grid):**
    *   Карточки 6 машин.
    *   Внутри карточки: Статус (пульсирующая точка), Мощность, Температура.
    *   **Smart Badge:** Если машина теряет деньги, на карточке плашка: *"-1200 ₽/час"*.
3.  **Лента Событий (Live Feed):**
    *   Скроллящийся список логов справа.
    *   Пример: *[14:15] ГПУ-2: Обнаружена вибрация. Предиктивный алерт.*

### Экран 2: Детальная карточка машины («Инженерный Пульт»)
**Задача:** Показать причину аварии.

1.  **Сводка (Header):** Фото машины, модель (Jenbacher J420), Наработка (Моточасы).
2.  **График Корреляции (Main Chart):**
    *   Комбинированный график ECharts.
    *   Линия: Температура (растет).
    *   Столбцы: Мощность (падает).
    *   *Цель:* Визуально показать: Температура убивает Мощность.
3.  **Тепловая карта цилиндров (Heatmap):**
    *   Сетка 4x5 квадратов (20 цилиндров).
    *   Все зеленые/желтые, но Цилиндр №12 — **Красный** (перегрев).
    *   *Это показывает глубину аналитики.*
4.  **Виджет «Почему я теряю деньги?»:**
    *   Текстовое объяснение (генерируется логикой): *"Снижение КПД на 12% вызвано перегревом выхлопных газов. Возможная причина: низкое метановое число топлива."*

### Экран 3: Техническое Обслуживание («Предиктив»)
**Задача:** Планирование закупок и ремонтов.

1.  **Timeline (Диаграмма):**
    *   Полоски времени до следующего ТО.
    *   Цветовое кодирование: Зеленый (>500ч), Желтый (<100ч), Красный (Просрочено).
2.  **Умный Прогноз (AI Prediction):**
    *   Блок: *"ГПУ-3: Плановое ТО через 1000ч. Но судя по росту вибрации, подшипник турбины выйдет из строя через **200ч**. Рекомендуем заказать запчасть (Артикул: Turbo-bearing-J420)."*
3.  **Калькулятор бюджета:**
    *   Чек-боксами выбираем предстоящие ТО.
    *   Внизу сумма: *"Итого к закупке: 1 450 000 ₽"*. Кнопка *"Сформировать заявку в 1С"*.

***

## 5. Требования к реализации (Quality of Life)
1.  **Темная тема:** Глубокий синий/серый фон (`slate-950`), неоновые акценты. Профессиональный, "дорогой" вид.
2.  **Реактивность:** Данные обновляются раз в 1 секунду без перезагрузки страницы (MQTT subscription).
3.  **Анимации:**
    *   При появлении алертов — всплывающие тосты.
    *   При открытии страницы — графики плавно рисуются слева направо.
4.  **Адаптивность:** Должно нормально смотреться на ноутбуке и планшете (iPad), так как директора часто смотрят с планшета.